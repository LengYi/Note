# AutoLayout

## 概念说明

（1）约束优先级

```swift
约束不仅限于等量关系，它还可以是(>=)或者(<=)来描述两个属性之间的关系，由 NSLayoutRelation 定义。约束还有 1 ~ 1000的优先级，优先级为1000的约束为必须满足，优先级为 1 ~ 999 的约束为可选约束，数字越大其优先级越高，其满足的可能性越高，自动布局系统在满足了所有优先级为 1000 的约束后，会按照优先级从高到低的顺序满足可选约束。默认情况下，所有约束优先级都是 1000，即必须满足。
```



**内部内容尺寸（Intrinsic Content Size）**

```swift
简单来说就是，像按钮、文本标签这类视图控件，在布局的时候，它们自己内部比外部布局代码更清楚自己需要多大的尺寸来显示自己的内容。而这个尺寸就是由内部内容尺寸（intrinsic content size）来传达的。这就相当于，内部内容尺寸告诉布局系统：“这个视图里面包含了一些你不能理解的内容，但是我给你指出了那些内容有多大。”
```



AutoLayout中添加的约束也有优先级,优先级的数值是1~1000。分为两种情况：

- 一种情况是我们经常添加的各种约束,默认的优先级是1000，也就是最高级别，条件允许的话系统会满足我们所有的约束需求。

- 另外一种情况就是固有约束(intinsic content size)，严格来说这个这个更像是指UILabel和UIButton控件的一种属性,但是在AutoLayout中这个属性的取值和约束优先级的属性相结合才能完成图形的绘制。
   我们知道UIButton和UILabel两种控件可以根据内容长短来控制控件宽度，当展示内容的宽度满足不了约束的要求时(过短或者过宽)，控件就会被拉伸或者压缩，当我们不想控件被拉伸或者压缩时，就需要设置控件的固有约束（intinsic content size）来实现我们的需求。固有约束分为两种：

  + 1 ) Content Hugging Priority
     官方文档的解释是
     `Returns the priority with which a view resists being made larger than its intrinsic size.`
     即表示的是控件的抗拉伸优先级，优先级越高，越不易被拉伸，默认为25

    决定是否能够拉伸到大于自身内容尺寸；优先级比较大时，最大尺寸是内容尺寸

  

  使用场景：
   当一个视图上有多个 `intrinsic content size` 的子控件，子视图的总和，不够填充父视图区域时，此属性可以控制优先拉伸哪个视图内容。

  + 2）Content Compression Resistance Priority
     `Returns the priority with which a view resists being made smaller than its intrinsic size.`
     这个优先级的字面意思很明确了，是防压缩优先级，优先级越高，越不易被压缩，默认为750

  ​       决定着是否能压缩到小于自身内容尺寸；优先级大时，最小尺寸是内容尺寸

  

  使用场景：
   当一个视图上有多个 `intrinsic content size` 的子控件，并且子控件可能会超出父视图的区域时，此属性可控制哪些视图被内容被优先压缩，使其不超出父视图区域。



### 如何避免产生约束问题

##### 1. 不要试图用masonry去更新xib的约束

原因：masonry内部会判断如果是系统的约束就不处理，反而添加了新的约束，这样必然会出现约束冲突问题。

##### 2. tableHeaderView约束优先级要降低

原因：我们要创建一个view让tableHeaderView=view，并在view上添加子的我们需要的那个整体view。然后约束时候要降低优先级。这样当tableHeaderView在height=0瞬间不至于约束出问题。

##### 3. tableView使用估计高度时候要降低更新高度的约束优先级

原因: 在使用tableView估计高度时候，系统会自动计算出cell的高度并给UITableViewCellContentView添加一个高度的约束。当重用时候我们更新了cell子视图的高度导致整个cell高度变高和一开始的系统自动计算的高度约束冲突。这时候我们降低更新的子视图的高度约束的优先级可以避免和之前系统计算出来的cell高度约束冲突。

##### 4. 当一行布局了多个lab时候要添加两者的横向约束并设置好相应的抗压缩抗拉伸优先级

原因：一行布局多个lab时候如果我们不设置两个lab之间的约束，那么当两个lab要显示很长的文字时候会出现两个lab重叠现象，我们当然不希望用户看到这种显现象，所以两个lab中间一定要设置约束距离。

当我们设置了两个lab之间的约束距离后就要设置好两个lab的抗压缩抗拉伸优先级。因为lab有自动适应尺寸的特性。所以我们利用抗拉伸优先级来控制允许哪个lab的文字宽度小于控件自身高度，当然抗拉伸优先级较低的lab的文字宽度会小于控件本身的宽度。（如果不设置，系统将不知道到底哪个lab文字宽度可以小于控件自身的宽度，所以就出现了约束警告问题，图层中会有叹号）

之后我们要设置好相应的抗压缩优先级，决定当文字多的情况下，到底哪个要进行压缩显示省略号，当然抗压缩优先级小的那个要显示省略号。

默认的抗拉伸优先级大小是250（UILayoutPriorityDefaultLow）。
 默认的抗压缩优先级大小是750UILayoutPriorityDefaultHigh）
 还有两位两个优先级的宏可以用(UILayoutPriorityFittingSizeLevel=50),(UILayoutPriorityRequired=1000)

### 如果产生约束问题如何解决

##### 1. 如果控制台打印约束警告问题，并试图打破哪个约束来解决问题，界面又显示的正常

1. 是不是用masonry更新了xib的约束导致了新增一个冲突的约束。这时候要用xib拖约束方式更新值。
2. 是不是系统导致一瞬间tableHeaderView.height=0导致了约束冲突。这时候要降低约束优先级
3. 是不是使用tableView的估计高度来自动适应cell行高，但是认为的更新了cell子视图的高度。这时候也要降低更新高度约束的优先级。

##### 2. 查看图层看到右上角有约束警告叹号

1. 查看布局中是不是一行有多个lab这种自动适应尺寸的控件，但是没有设置好抗压缩抗拉伸优先级。这时候要设置好相应的抗压缩抗拉伸优先级。约束冲突问题总结